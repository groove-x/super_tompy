#ifndef _H_CONST_
#define _H_CONST_

#include <Arduino.h>
#include <AnimationServo.h>


namespace Rhythm
{
    enum Pin
    {
        DOGMA_HAND_R = 1, // スネア(瓦)
        DOGMA_HAND_L = 3, // スネア
        DOGMA_FOOT_R = 5, // バスドラ
        DOGMA_FOOT_L = 7, // ハイハット
        SIGMA_HAND_R = 8, // ギター
        SIGMA_HAND_L = 9, // ギター
        MAGMA_HAND_R = 10, // ベース
        MAGMA_HAND_L = 11, // ベース
        NUM = 8
    };

    constexpr int beat_len = 16;
    constexpr int pattern_num = 9;
    constexpr int pattern_len = 20;
    constexpr int pattern_len_for_1 = 2;

    // 1が無音区間。スリープしたいときは無音区間を使う
    constexpr uint8_t beat[pattern_num][Pin::NUM][beat_len]
    = {{
        {1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0},
        {0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0} 
    },{
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0}
    },{
        {0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0}
    },{
        {1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
    },{
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0},
        {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
    },{
        {1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0},
        {0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
    },{
        {0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
    },{
        {0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0},
        {0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
    },{
        {0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0},
        {0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
        {0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0},
    }};

    // uint8_t patterns[pattern_len] = {0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1};
    // uint8_t patterns[pattern_len] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    constexpr uint8_t patterns[pattern_len] = {0, 1, 1, 1, 1, 2, 2, 2, 3, 1, 1, 1, 4, 1, 5, 6, 7, 7, 7, 8};
    // constexpr uint8_t patterns[pattern_len_for_1] = {0, 1}; // 1のみ繰り返し再生
    // constexpr uint8_t patterns[pattern_len] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};

    constexpr int beatInterval = (60. / 560) * 1000;  // 560 bpm and 107ms 
    // int beatInterval = (60. / 120.) / 4. * 1000; // 120 bpm -> 2 beat / 1sec -> 500msec / 4つ打ち (500 / 4) = 125
    // int beatInterval = (60. / 85.) / 4. * 1000;  // 85 bpm 
    // int beatInterval = (60. / 81.4) / 4. * 1000; // 81.4 bpm 
    // int beatInterval = (60. / 60.) / 4. * 1000;  // 60 bpm
    // int beatInterval = (60. / 150.) / 4. * 1000;  // 60 bpm
    // int beatInterval = (60. / 75.) / 4. * 1000;  // 60 bpm
    // int beatInterval = (60. / 30.) / 4. * 1000;  // 30 bpm

    constexpr uint8_t getBeat(int patternIndex, int servo_index, int beat_index){
        return beat[patterns[patternIndex]][servo_index][beat_index];
    }    
}

namespace Anim
{
    enum Pin
    {
        DOGMA_HEAD_PITCH = 0, 
        DOGMA_HEAD_ROLL = 2, 
        SIGMA_HEAD_PITCH = 4, 
        SIGMA_HEAD_ROLL = 6, 
        NUM = 4
    };
    constexpr int keyframe_len = 8;

    constexpr int dram_pitch_len = 8;
    constexpr int dram_roll_len = 9;
    constexpr int vocal_pitch_len = 9;
    constexpr int vocal_roll_len = 9;

    KeyFrame keyframes[keyframe_len]
     = { 
         {110, 200}, 
         {90, 200}, 
         {110, 200}, 
         {90, 200}, 
         {120, 100}, 
         {90, 100}, 
         {120, 100}, 
         {90, 100}};

    // == 頭大きく振る
    // pitch 80(頭引く) ~ 145(頭下げる)
    KeyFrame neck_pitch_frames[dram_pitch_len] = { 
        {120,150 }, 
        {80, 150 }, 
        {120,150 }, 
        {80, 150 } , 
        {120,150 }, 
        {80, 150 }, 
        {120,150 }, 
        {80, 5000 }, 
        }; 

    // roll 85(右) ~ 120(左)
    KeyFrame neck_roll_frames[dram_roll_len] = { 
        {100, 200} , 
        {100, 200}, 
        {100, 200}, 
        {100, 200}, 
        {100, 200} , 
        {100, 200}, 
        {100, 200}, 
        {100, 200}, 
        {100, 5000}, 
        }; 

    float map(int value, float start1, float stop1, float start2, float stop2)
    {
        return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
    }
}


#endif // _H_CONST_